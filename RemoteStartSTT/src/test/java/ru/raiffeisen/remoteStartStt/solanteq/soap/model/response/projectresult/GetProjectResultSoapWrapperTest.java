package ru.raiffeisen.remoteStartStt.solanteq.soap.model.response.projectresult;

import com.fasterxml.jackson.dataformat.xml.XmlMapper;
import org.junit.Test;
import ru.raiffeisen.remoteStartStt.solanteq.soap.model.executeProjectResponse.executeprojectresponse.ExecuteProjectResponseWrapper;
import ru.raiffeisen.remoteStartStt.solanteq.soap.model.executeProjectResponse.getprojectresult.GetProjectResultSoapWrapper;
import ru.raiffeisen.remoteStartStt.solanteq.soap.model.executeProjectResponse.getscenarioresult.GetScenarioResultWrapper;

public class GetProjectResultSoapWrapperTest {
    private final String ProjectResultResponse = "<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"><soapenv:Header/><soapenv:Body><slq:getProjectResultResponse xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:slq=\"http://www.solanteq.com/solar-proof-api\"><slq:header><slq:protocol><slq:name>solar-ws</slq:name><slq:version>2.0</slq:version></slq:protocol><slq:messageId>2ca7f8f0-5c92-4619-b2f5-592ca75ad6de</slq:messageId><slq:messageDate>2015-12-24T13:53:55</slq:messageDate><slq:originator><slq:system>EXTERNAL</slq:system></slq:originator></slq:header><slq:body><slq:response><slq:type>SUCCESS</slq:type><slq:code>SLR-0001</slq:code><slq:message>Successfully completed</slq:message></slq:response><slq:result>TIMEOUT</slq:result><slq:startDate>2020-07-28T12:58:53.903797</slq:startDate><slq:finishDate>2020-07-28T13:04:56.406277</slq:finishDate><slq:passed>0</slq:passed><slq:failed>18</slq:failed><slq:skipped>1</slq:skipped><slq:scenarios><slq:scenario><slq:id>182138</slq:id><slq:code>nspk visa</slq:code><slq:name>Ecom Retail Nspk VISA</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182134</slq:id><slq:code>visa</slq:code><slq:name>Ecom Retail VISA</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182130</slq:id><slq:code>nspk mc</slq:code><slq:name>Ecom Retail Nspk MC</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182126</slq:id><slq:code>mc</slq:code><slq:name>Ecom Retail MC</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182125</slq:id><slq:code>mir</slq:code><slq:name>Ecom Retail MIR</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182124</slq:id><slq:code>visa reversal</slq:code><slq:name>Ecom Retail + Reversal  VISA</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182123</slq:id><slq:code>mc refund 0420</slq:code><slq:name>Ecom Retail +  Refund(0420) MC</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182122</slq:id><slq:code>visa refund 0420</slq:code><slq:name>Ecom Retail + Refund(0420)  VISA</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182121</slq:id><slq:code>nspk visa refund 0420</slq:code><slq:name>Ecom Retail + Refund(0420)  NSPK VISA</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182120</slq:id><slq:code>nspk mc refund 0420</slq:code><slq:name>Ecom Retail +  Refund(0420) NSPK MC</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182119</slq:id><slq:code>refund 0420 mir</slq:code><slq:name>Ecom Retail MIR + Refund(0420) MIR</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182118</slq:id><slq:code>mc compilition</slq:code><slq:name>Ecom Retail + Compilition MC</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182117</slq:id><slq:code>nspk mc compilition</slq:code><slq:name>Ecom Retail + Compilition Nspk MC</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182116</slq:id><slq:code>visa compilition</slq:code><slq:name>Ecom Retail + Compilition VISA</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182115</slq:id><slq:code>nspk visa compilition</slq:code><slq:name>Ecom Retail + Compilition Nspk VISA</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182114</slq:id><slq:code>mir compilition</slq:code><slq:name>Ecom Retail + Compilition MIR</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182113</slq:id><slq:code>nspk visa reversal</slq:code><slq:name>Ecom Retail + Reversal  NSPK VISA</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario><slq:scenario><slq:id>182112</slq:id><slq:code>mc (1)</slq:code><slq:name>Ecom Retail MC (MasterPass)</slq:name><slq:result>SKIPPED</slq:result></slq:scenario><slq:scenario><slq:id>182111</slq:id><slq:code>mc (2)</slq:code><slq:name>Ecom Retail MC (test)</slq:name><slq:result>TIMEOUT</slq:result></slq:scenario></slq:scenarios></slq:body></slq:getProjectResultResponse></soapenv:Body></soapenv:Envelope>";

    private final String executeProjectResponseResponse = "<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"><soapenv:Header/><soapenv:Body><slq:executeProjectResponse xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:slq=\"http://www.solanteq.com/solar-proof-api\"><slq:header><slq:protocol><slq:name>solar-ws</slq:name><slq:version>2.0</slq:version></slq:protocol><slq:messageId>2ca7f8f0-5c92-4619-b2f5-592ca75ad6de</slq:messageId><slq:messageDate>2015-12-24T13:53:55</slq:messageDate><slq:originator><slq:system>EXTERNAL</slq:system></slq:originator></slq:header><slq:body><slq:response><slq:type>SUCCESS</slq:type><slq:code>SLR-0001</slq:code><slq:message>Successfully completed</slq:message></slq:response><slq:projectResultRef><slq:id>102909</slq:id></slq:projectResultRef></slq:body></slq:executeProjectResponse></soapenv:Body></soapenv:Envelope>";

    private final String executeScenarioResponse = "<?xml version='1.0' encoding='UTF-8'?><soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"><soapenv:Header/><soapenv:Body><slq:getScenarioResultResponse xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:slq=\"http://www.solanteq.com/solar-proof-api\"><slq:header><slq:protocol><slq:name>solar-ws</slq:name><slq:version>2.0</slq:version></slq:protocol><slq:messageId>2ca7f8f0-5c92-4619-b2f5-592ca75ad6de</slq:messageId><slq:messageDate>2015-12-24T13:53:55</slq:messageDate><slq:originator><slq:system>EXTERNAL</slq:system></slq:originator></slq:header><slq:body><slq:response><slq:type>SUCCESS</slq:type><slq:code>SLR-0001</slq:code><slq:message>Successfully completed</slq:message></slq:response><slq:code>mc refund 0420</slq:code><slq:name>Ecom Retail +  Refund(0420) MC</slq:name><slq:result>OK</slq:result><slq:startDate>2020-08-04T16:41:21.701909</slq:startDate><slq:finishDate>2020-08-04T16:41:33.223041</slq:finishDate><slq:steps><slq:step><slq:id>579585</slq:id><slq:ordinal>10</slq:ordinal><slq:startDate>2020-08-04T16:41:21.705796</slq:startDate><slq:finishDate>2020-08-04T16:41:27.11185</slq:finishDate><slq:result>OK</slq:result><slq:name>Операция в Ecom pos, ответ от MC</slq:name><slq:direction>OUT</slq:direction><slq:resultMessage>Success</slq:resultMessage><slq:messageType>NONE</slq:messageType><slq:validations><slq:validation><slq:id>288824</slq:id><slq:name>posResponse=00</slq:name><slq:expression>${posResponse}</slq:expression><slq:type>EQUAL</slq:type><slq:result>OK</slq:result><slq:source>EXP</slq:source><slq:resultMessage>Actual value \"00\" equals to expected \"00\"</slq:resultMessage><slq:expected><slq:type>STRING</slq:type><slq:value>00</slq:value></slq:expected><slq:actual><slq:type>STRING</slq:type><slq:value>00</slq:value></slq:actual></slq:validation></slq:validations></slq:step><slq:step><slq:id>579587</slq:id><slq:ordinal>10.10</slq:ordinal><slq:startDate>2020-08-04T16:41:21.712451</slq:startDate><slq:finishDate>2020-08-04T16:41:27.041551</slq:finishDate><slq:result>OK</slq:result><slq:name>Входящее сообщение от MC 0100-0110</slq:name><slq:direction>IN</slq:direction><slq:resultMessage>The message processed successfully</slq:resultMessage><slq:messageType>ISO</slq:messageType><slq:channel><slq:id>100005</slq:id><slq:auditDate>2018-10-17T12:32:03.53</slq:auditDate><slq:code>mcIn</slq:code><slq:name>Mastercard Incoming</slq:name><slq:dialect><slq:id>2</slq:id><slq:auditDate>2018-06-22T16:09:45.238246</slq:auditDate><slq:code>mastercard</slq:code><slq:name>MasterCard</slq:name><slq:description>Сообщение в формате MasterCard</slq:description></slq:dialect></slq:channel><slq:validations/></slq:step><slq:step><slq:id>579586</slq:id><slq:ordinal>10.20</slq:ordinal><slq:startDate>2020-08-04T16:41:21.712314</slq:startDate><slq:finishDate>2020-08-04T16:41:27.093474</slq:finishDate><slq:result>OK</slq:result><slq:name>Операция в Ecom-терминале</slq:name><slq:direction>OUT</slq:direction><slq:description>Операция в Ecom-терминале</slq:description><slq:resultMessage>The message processed successfully</slq:resultMessage><slq:messageType>ISO</slq:messageType><slq:channel><slq:id>100017</slq:id><slq:auditDate>2018-08-10T12:02:17.807</slq:auditDate><slq:code>tsysecom</slq:code><slq:name>TSYS ECOM</slq:name><slq:dialect><slq:id>12</slq:id><slq:auditDate>2018-07-05T15:32:38.109655</slq:auditDate><slq:code>tsys-h2h</slq:code><slq:name> TSYS H2H</slq:name><slq:description>Сообщение в формате TSYS H2H</slq:description></slq:dialect></slq:channel><slq:validations/></slq:step><slq:step><slq:id>579588</slq:id><slq:ordinal>20</slq:ordinal><slq:startDate>2020-08-04T16:41:27.129098</slq:startDate><slq:finishDate>2020-08-04T16:41:32.686372</slq:finishDate><slq:result>OK</slq:result><slq:name>Refund  в Ecom pos,ответ от  MC</slq:name><slq:direction>OUT</slq:direction><slq:resultMessage>Success</slq:resultMessage><slq:messageType>NONE</slq:messageType><slq:validations/></slq:step><slq:step><slq:id>579589</slq:id><slq:ordinal>20.10</slq:ordinal><slq:startDate>2020-08-04T16:41:27.135389</slq:startDate><slq:finishDate>2020-08-04T16:41:32.677279</slq:finishDate><slq:result>OK</slq:result><slq:name>Операция в Ecom-терминале</slq:name><slq:direction>OUT</slq:direction><slq:description>Операция в Ecom-терминале</slq:description><slq:resultMessage>The message processed successfully</slq:resultMessage><slq:messageType>ISO</slq:messageType><slq:channel><slq:id>100017</slq:id><slq:auditDate>2018-08-10T12:02:17.807</slq:auditDate><slq:code>tsysecom</slq:code><slq:name>TSYS ECOM</slq:name><slq:dialect><slq:id>12</slq:id><slq:auditDate>2018-07-05T15:32:38.109655</slq:auditDate><slq:code>tsys-h2h</slq:code><slq:name> TSYS H2H</slq:name><slq:description>Сообщение в формате TSYS H2H</slq:description></slq:dialect></slq:channel><slq:validations/></slq:step><slq:step><slq:id>579590</slq:id><slq:ordinal>30</slq:ordinal><slq:startDate>2020-08-04T16:41:32.696005</slq:startDate><slq:finishDate>2020-08-04T16:41:33.21507</slq:finishDate><slq:result>OK</slq:result><slq:name>Проверка данных транзакции в БД Online</slq:name><slq:direction>OUT</slq:direction><slq:resultMessage>The message processed successfully</slq:resultMessage><slq:messageType>JDBC</slq:messageType><slq:channel><slq:id>100000</slq:id><slq:auditDate>2018-06-22T16:53:15.922</slq:auditDate><slq:code>online</slq:code><slq:name>Online DB</slq:name><slq:dialect><slq:id>5</slq:id><slq:auditDate>2018-06-22T16:09:45.250545</slq:auditDate><slq:code>JDBC</slq:code><slq:name>JDBC</slq:name><slq:description>Запрос в базу данных</slq:description></slq:dialect></slq:channel><slq:validations><slq:validation><slq:id>288825</slq:id><slq:name>Проверка транзакций в БД</slq:name><slq:expression>${Transaction}</slq:expression><slq:type>MULTIROW</slq:type><slq:result>OK</slq:result><slq:source>EXP</slq:source><slq:resultMessage>Table was validated successfully</slq:resultMessage><slq:expected><slq:type>MULTIROW</slq:type><slq:value>{\"validations\":[{\"variable\":\"i039_resp_cd\",\"dataType\":\"STRING\",\"type\":\"EQUAL\"},{\"variable\":\"i000_msg_type\",\"dataType\":\"STRING\",\"type\":\"EQUAL\"},{\"variable\":\"i022_pem\",\"dataType\":\"STRING\",\"type\":\"EQUAL\"},{\"variable\":\"i061_4\",\"dataType\":\"STRING\",\"type\":\"EQUAL\"},{\"variable\":\"i061_10\",\"dataType\":\"STRING\",\"type\":\"EQUAL\"}],\"rows\":[{\"i039_resp_cd\":\"00\",\"i000_msg_type\":\"0110\",\"i022_pem\":\"81\",\"i061_4\":\"5\",\"i061_10\":\"6\"},{\"i039_resp_cd\":\"00\",\"i000_msg_type\":\"0420\",\"i022_pem\":null,\"i061_4\":\"5\",\"i061_10\":\"6\"}]}</slq:value></slq:expected><slq:actual><slq:type>MULTIROW_RESULT</slq:type><slq:value>[{\"i039_resp_cd\":{\"expected\":\"00\",\"actual\":\"00\",\"result\":\"OK\"},\"i000_msg_type\":{\"expected\":\"0420\",\"actual\":\"0420\",\"result\":\"OK\"},\"i022_pem\":{\"result\":\"OK\"},\"i061_4\":{\"expected\":\"5\",\"actual\":\"5\",\"result\":\"OK\"},\"i061_10\":{\"expected\":\"6\",\"actual\":\"6\",\"result\":\"OK\"}}, {\"i039_resp_cd\":{\"expected\":\"00\",\"actual\":\"00\",\"result\":\"OK\"},\"i000_msg_type\":{\"expected\":\"0110\",\"actual\":\"0110\",\"result\":\"OK\"},\"i022_pem\":{\"expected\":\"81\",\"actual\":\"81\",\"result\":\"OK\"},\"i061_4\":{\"expected\":\"5\",\"actual\":\"5\",\"result\":\"OK\"},\"i061_10\":{\"expected\":\"6\",\"actual\":\"6\",\"result\":\"OK\"}}]</slq:value></slq:actual></slq:validation></slq:validations></slq:step></slq:steps></slq:body></slq:getScenarioResultResponse></soapenv:Body></soapenv:Envelope>";

    //@Test
    public void successMappingProjectResultResponse() throws Exception {
        XmlMapper responseMapper = new XmlMapper();
        GetProjectResultSoapWrapper result = responseMapper.readValue(ProjectResultResponse, GetProjectResultSoapWrapper.class);
        System.out.println(result.getBody().getGetProjectResultResponse().getBody().getScenarios().get(0).getId());
    }

    //@Test
    public void successMappingExecuteProjectResponse() throws Exception {
        XmlMapper responseMapper = new XmlMapper();
        ExecuteProjectResponseWrapper result = responseMapper.readValue(executeProjectResponseResponse, ExecuteProjectResponseWrapper.class);
        System.out.println(result.getBody().getExecuteProjectResponse().getBody().getProjectResultRef().getId());
    }

   // @Test
    public void successMappingExecuteScenarioResponse() throws Exception {
        XmlMapper responseMapper = new XmlMapper();
        GetScenarioResultWrapper result = responseMapper.readValue(executeScenarioResponse, GetScenarioResultWrapper.class);
        System.out.println(result.getBody().getGetScenarioResultResponse().getBody().getSteps().get(1).getId());
    }


    @Test
    public void getCountSteps() throws Exception {
        XmlMapper responseMapper = new XmlMapper();
        GetScenarioResultWrapper result = responseMapper.readValue(executeScenarioResponse, GetScenarioResultWrapper.class);
        System.out.println(result.getBody().getGetScenarioResultResponse().getBody().getSteps().size());
    }

}
